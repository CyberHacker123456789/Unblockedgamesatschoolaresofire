<!DOCTYPE html>
<html>
<head>
    <title>Asteroid Hunter: Pro Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #0d0d0d; font-family: 'Courier New', Courier, monospace; color: white; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; left: 20px; font-size: 20px; pointer-events: none; text-shadow: 2px 2px black; }
        .screen-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; background: rgba(0, 0, 0, 0.95); padding: 30px; border-radius: 10px; border: 2px solid #00ffcc; display: none; width: 80%; max-width: 500px; z-index: 100; }
        #settingsScreen { display: block; }
        h2 { color: #00ffcc; margin-top: 0; }
        .control-group { margin: 15px 0; padding: 10px; border-bottom: 1px solid #333; text-align: left; }
        .control-label { display: block; margin-bottom: 10px; font-weight: bold; color: #aaa; }
        
        /* Color Options */
        .color-option { width: 30px; height: 30px; border-radius: 50%; display: inline-block; margin-right: 10px; cursor: pointer; border: 3px solid transparent; }
        .color-option.selected { border: 3px solid white; }
        
        /* Toggles */
        .switch { cursor: pointer; background: #333; padding: 5px 15px; border-radius: 5px; border: 1px solid #555; color: white; margin-right: 10px; }
        .switch.on { background: #008855; border-color: lime; }

        .game-button { background: #00ffcc; color: black; border: none; padding: 15px 30px; font-size: 20px; cursor: pointer; margin-top: 20px; font-family: inherit; font-weight: bold; width: 100%; }
        .game-button:hover { background: white; }
    </style>
</head>
<body>
    <div id="ui">
        SCORE: <span id="score">0</span> | BEST: <span id="highScore">0</span>
        <div id="health"></div>
    </div>

    <div id="settingsScreen" class="screen-container">
        <h2>MISSION CONTROL</h2>
        
        <div class="control-group">
            <span class="control-label">SHIP COLOR</span>
            <div id="colorPicker">
                <span class="color-option selected" data-color="white" style="background-color: white;"></span>
                <span class="color-option" data-color="#00ff00" style="background-color: #00ff00;"></span>
                <span class="color-option" data-color="#00ffff" style="background-color: #00ffff;"></span>
                <span class="color-option" data-color="#ff00ff" style="background-color: #ff00ff;"></span>
            </div>
        </div>

        <div class="control-group">
            <span class="control-label">SYSTEMS</span>
            <button id="soundToggle" class="switch on" onclick="toggleSound()">SOUND: ON</button>
            <button id="autoToggle" class="switch" onclick="toggleAuto()">AUTOSHOOT: OFF</button>
        </div>

        <button class="game-button" onclick="startGame()">LAUNCH (Space)</button>
    </div>

    <div id="gameOver" class="screen-container">
        <h1 style="color: red;">SHIP DESTROYED</h1>
        <p>Score: <span id="finalScore">0</span></p>
        <button class="game-button" onclick="showSettings()">RETURN TO BASE</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let score = 0, highScore = localStorage.getItem('astroHighScore') || 0;
    let lives = 3, gameRunning = false, asteroids = [], bullets = [], particles = [], keys = {};
    let shipColor = 'white', autoShoot = false, soundEnabled = true, lastShot = 0;

    const ship = { x: canvas.width/2, y: canvas.height/2, r: 12, a: -Math.PI/2, xv: 0, yv: 0, thrust: 0.15, delay: 12 };
    document.getElementById('highScore').innerText = highScore;

    // --- AUDIO ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioCtx; 

    function playSound(freq, duration) {
        if (!soundEnabled) return;
        if (!audioCtx) audioCtx = new AudioContext();
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.frequency.value = freq;
        osc.connect(g); g.connect(audioCtx.destination);
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    // --- CONTROLS ---
    function toggleSound() {
        soundEnabled = !soundEnabled;
        const btn = document.getElementById('soundToggle');
        btn.innerText = `SOUND: ${soundEnabled ? 'ON' : 'OFF'}`;
        btn.classList.toggle('on');
    }

    function toggleAuto() {
        autoShoot = !autoShoot;
        const btn = document.getElementById('autoToggle');
        btn.innerText = `AUTOSHOOT: ${autoShoot ? 'ON' : 'OFF'}`;
        btn.classList.toggle('on');
    }

    document.querySelectorAll('.color-option').forEach(opt => {
        opt.onclick = () => {
            document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
            opt.classList.add('selected');
            shipColor = opt.dataset.color;
        };
    });

    window.addEventListener('keydown', e => { keys[e.code] = true; if(e.code === 'Space' && !gameRunning) startGame(); });
    window.addEventListener('keyup', e => keys[e.code] = false);

    function startGame() {
        document.getElementById('settingsScreen').style.display = 'none';
        document.getElementById('gameOver').style.display = 'none';
        score = 0; lives = 3; asteroids = []; bullets = [];
        ship.x = canvas.width/2; ship.y = canvas.height/2; ship.xv = 0; ship.yv = 0;
        for(let i=0; i<6; i++) spawnAsteroid();
        gameRunning = true;
        update();
    }

    function spawnAsteroid() {
        asteroids.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: 30, xv: (Math.random()-0.5)*3, yv: (Math.random()-0.5)*3 });
    }

    function showSettings() {
        gameRunning = false;
        document.getElementById('gameOver').style.display = 'none';
        document.getElementById('settingsScreen').style.display = 'block';
    }

    function update() {
        if (!gameRunning) return;
        ctx.fillStyle = '#0d0d0d'; ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Movement
        if (keys['ArrowLeft']) ship.a -= 0.08;
        if (keys['ArrowRight']) ship.a += 0.08;
        if (keys['ArrowUp']) {
            ship.xv += ship.thrust * Math.cos(ship.a);
            ship.yv += ship.thrust * Math.sin(ship.a);
            particles.push({ x: ship.x, y: ship.y, xv: -ship.xv*0.5, yv: -ship.yv*0.5, life: 1.0 });
        }
        ship.x += ship.xv; ship.y += ship.yv;
        ship.xv *= 0.98; ship.yv *= 0.98;

        if (ship.x < 0) ship.x = canvas.width; if (ship.x > canvas.width) ship.x = 0;
        if (ship.y < 0) ship.y = canvas.height; if (ship.y > canvas.height) ship.y = 0;

        // Shooting logic
        if (lastShot > 0) lastShot--;
        if ((autoShoot || keys['Space']) && lastShot === 0) {
            bullets.push({ x: ship.x, y: ship.y, xv: 8 * Math.cos(ship.a), yv: 8 * Math.sin(ship.a), d: 0 });
            lastShot = ship.delay; playSound(800, 0.1);
        }

        // Particles
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i]; p.x += p.xv; p.y += p.yv; p.life -= 0.03;
            if (p.life <= 0) particles.splice(i, 1);
            else { ctx.fillStyle = `rgba(255, 150, 0, ${p.life})`; ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill(); }
        }

        // Bullets
        for (let i = bullets.length - 1; i >= 0; i--) {
            let b = bullets[i]; b.x += b.xv; b.y += b.yv; b.d++;
            if (b.d > 60) bullets.splice(i, 1);
            else { ctx.fillStyle = '#00ffcc'; ctx.fillRect(b.x, b.y, 4, 4); }
        }

        // Asteroids
        asteroids.forEach((a, ai) => {
            a.x += a.xv; a.y += a.yv;
            if (a.x < 0) a.x = canvas.width; if (a.x > canvas.width) a.x = 0;
            ctx.strokeStyle = 'white'; ctx.lineWidth = 1; ctx.beginPath(); ctx.arc(a.x, a.y, a.r, 0, Math.PI*2); ctx.stroke();
            
            bullets.forEach((b, bi) => {
                if (Math.hypot(a.x - b.x, a.y - b.y) < a.r) {
                    asteroids.splice(ai, 1); bullets.splice(bi, 1);
                    score += 100; playSound(200, 0.3); spawnAsteroid();
                    document.getElementById('score').innerText = score;
                }
            });

            if (Math.hypot(a.x - ship.x, a.y - ship.y) < a.r + ship.r) {
                lives--; playSound(100, 0.5); asteroids.splice(ai, 1); spawnAsteroid();
                document.getElementById('health').innerHTML = "❤️".repeat(lives);
                if (lives <= 0) {
                    gameRunning = false;
                    if (score > highScore) { highScore = score; localStorage.setItem('astroHighScore', highScore); }
                    document.getElementById('gameOver').style.display = 'block';
                    document.getElementById('finalScore').innerText = score;
                }
            }
        });

        // Draw Ship with Color
        ctx.strokeStyle = shipColor; ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(ship.x + ship.r * Math.cos(ship.a), ship.y + ship.r * Math.sin(ship.a));
        ctx.lineTo(ship.x - ship.r * (Math.cos(ship.a) + Math.sin(ship.a)), ship.y - ship.r * (Math.sin(ship.a) - Math.cos(ship.a)));
        ctx.lineTo(ship.x - ship.r * (Math.cos(ship.a) - Math.sin(ship.a)), ship.y - ship.r * (Math.sin(ship.a) + Math.cos(ship.a)));
        ctx.closePath(); ctx.stroke();

        requestAnimationFrame(update);
    }
    document.getElementById('health').innerHTML = "❤️".repeat(lives);
</script>
</body>
</html>
